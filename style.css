
/* Edit panels */
.duct-edit-box {
        background: #fafafa;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px 12px;
        margin: 6px 0 10px 0;
}
.duct-edit-box label { font-size: 13px; color: #333; }
.duct-edit-box input { border: 1px solid #ccc; border-radius: 4px; }

.valve-edit-box {
        background: #ffffff;
        border: 1px solid #cfd8dc;
        box-shadow: 0 2px 6px rgba(0,0,0,0.06);
        border-radius: 8px;
        padding: 10px 12px;
        margin-top: 6px;
        max-width: 520px;
}
.valve-edit-box label { font-size: 13px; color: #333; }
.valve-edit-box input { border: 1px solid #b0bec5; border-radius: 4px; }
.valve-edit-box .list-action-btn {
        border: none;
}

.valve-edit-row {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
}
.input { padding: 4px 6px; }
.input-sm { height: 28px; }
.w-140 { width: 140px; }
.w-110 { width: 110px; }
.w-100 { width: 100px; }
.w-80 { width: 80px; }
.spacer { flex: 1 1 auto; }
.btn { background: #eee; color: #444; padding: 6px 10px; border-radius: 4px; border: 1px solid #ddd; cursor: pointer; }
.btn-primary { background: #1976d2; color: #fff; border-color: #1976d2; }

/* Modal styles */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.modal {
    background: #fff;
    width: 100%;
    max-width: 720px;
    max-height: 90vh;          /* üîë RAJOITUS */
    display: flex;
    flex-direction: column;   /* üîë */
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}

.modal-header {
    padding: 12px 16px;
    font-weight: bold;
    border-bottom: 1px solid #ddd;
    flex-shrink: 0;
}

.modal-content {
    padding: 16px;
    overflow-y: auto;         /* üîë VIERITYS */
    flex: 1;                  /* üîë */
}

.modal-actions {
    padding: 10px 16px;
    border-top: 1px solid #ddd;
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    flex-shrink: 0;
}


/* Tap label layout */
.tap .tap-label {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(255,255,255,0.9);
        padding: 4px 6px;
        border-radius: 6px;
}
.tap.ok .tap-label { background: #e8f5e9; border: 1px solid #c8e6c9; }
.tap.warn .tap-label { background: #fff8e1; border: 1px solid #ffecb3; }
.tap.err .tap-label { background: #ffebee; border: 1px solid #ffcdd2; }
.tap.none .tap-label { background: #f5f5f5; border: 1px solid #e0e0e0; }
:root { --primary: #0066cc; --bg: #f4f7f9; --white: #ffffff; --text: #333; --success: #28a745; --danger: #dc3545; --supply: #0066cc; --extract: #d63384; --machine-bg: linear-gradient(135deg, #444 0%, #222 100%); }

body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }


.header { background-color: var(--primary); color: var(--white); padding: 15px; position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

.back-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0 10px 0 0; }


.view { display: none; padding: 15px; animation: fadeIn 0.2s; }

.view.active { display: block; }

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }


.card { background: var(--white); border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }


.list-item { background: var(--white); padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #ccc; box-shadow: 0 1px 3px rgba(0,0,0,0.05); cursor: pointer; }

.list-action-btn { background: none; border: none; font-size: 18px; color: #ccc; cursor: pointer; padding: 0 8px; }

.list-delete-btn:hover { color: var(--danger); }

.list-copy-btn:hover { color: var(--primary); }



input, select { width: 100%; padding: 12px; margin: 5px 0 15px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }

label { font-weight: 600; font-size: 13px; color: #555; }

.btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; margin-top: 10px; cursor: pointer; color: white; transition: 0.2s; }

.btn:active { transform: scale(0.98); }

.btn-primary { background-color: var(--primary); }

.btn-success { background-color: var(--success); }

.btn-secondary { background-color: #e2e6ea; color: #333; }

.btn-danger { background-color: var(--danger); margin-top: 20px; }

.btn-demo { background-color: #6f42c1; color: white; margin-top: 20px; font-size: 14px; }

.btn-optimize { background: linear-gradient(45deg, #28a745, #218838); color: white; margin-top: 10px; border:none; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3); }


.fab { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 50%; font-size: 30px; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 2000; }



.mode-selector { display: flex; gap: 5px; margin-bottom: 15px; }

.mode-btn { flex: 1; padding: 10px; border: 1px solid #ccc; background: #f0f0f0; cursor: pointer; border-radius: 8px; font-weight: bold; text-align: center; }

.mode-btn.active { background: var(--primary); color: white; border-color: var(--primary); }


.copy-controls { display: flex; gap: 5px; margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; }

.copy-btn { font-size: 11px; padding: 5px; flex: 1; background: #f8f9fa; border: 1px solid #ddd; cursor: pointer; border-radius: 4px; }



#view-visual { overflow-x: auto; overflow-y: hidden; min-height: 85vh; background: #fdfdfd; background-size: cover; background-position: center; background-repeat: no-repeat; }

.schematic-container { position: relative; min-width: 1000px; min-height: 800px; padding: 40px 20px; display: flex; }

#pipeCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }



.machine-unit { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); width: 105px; height: 150px; background: var(--machine-bg); color: white; border: 3px solid #555; border-radius: 2px; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; font-size: 11px; box-shadow: 4px 4px 12px rgba(0,0,0,0.3); cursor: pointer; }

.machine-port { position: absolute; width: 14px; height: 14px; background: #999; border: 2px solid #333; z-index: 11; cursor: pointer; }

.p-sup-1 { top: -8px; left: 20%; background: #b3d9ff; } .p-sup-2 { top: -8px; left: 70%; background: #b3d9ff; }

.p-ext-1 { bottom: -8px; left: 20%; background: #ffccd5; } .p-ext-2 { bottom: -8px; left: 70%; background: #ffccd5; }

.p-side-sup { top: 25%; right: -8px; background: #b3d9ff; } .p-side-ext { bottom: 25%; right: -8px; background: #ffccd5; }



.duct-lanes-wrapper { margin-left: 200px; display: flex; flex-direction: column; justify-content: center; gap: 60px; width: 100%; }

.duct-lane { position: relative; display: flex; align-items: center; min-height: 60px; padding-left: 40px; }

.duct-lane-pipe { position: absolute; left: 0; right: 20px; top: 50%; height: 6px; z-index: 0; }

.lane-supply .duct-lane-pipe { background-color: var(--supply); } .lane-extract .duct-lane-pipe { background-color: var(--extract); }

.lane-title { position: absolute; left: 0; top: -35px; font-weight: bold; font-size: 12px; color: #555; background: rgba(255,255,255,0.9); padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; display:flex; gap:10px; align-items:center; cursor: pointer; }

.del-lane-btn { color: #ccc; cursor: pointer; margin-left: 5px; } .del-lane-btn:hover { color: red; }

.velocity-badge { padding: 2px 5px; border-radius: 4px; font-size: 10px; color: white; }

.v-green { background: #28a745; } .v-yellow { background: #ffc107; color: #333; } .v-red { background: #dc3545; font-weight: bold; animation: pulse 2s infinite; }

@keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }



.valve-node { position: relative; background: white; border: 2px solid #ccc; border-radius: 6px; padding: 5px 8px; margin-right: 30px; z-index: 2; cursor: pointer; min-width: 80px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: 0.2s; }

.valve-node:hover { transform: scale(1.05); border-color: #666; }

.status-ok { border-color: var(--success); background: #e6fffa; border-width: 2px; }

.status-bad { border-color: #f1c40f; background: #fff9db; border-width: 2px; }

.status-worst { border-color: var(--danger); background: #fff0f0; border-width: 3px; font-weight: bold; }

.valve-node::before { content: ''; position: absolute; left: 50%; bottom: -10px; height: 10px; width: 2px; background: #ccc; z-index: -1; }


.add-valve-btn { background: white; border: 2px dashed #ccc; color: #ccc; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; z-index: 2; margin-left: 10px; }

.add-valve-btn:hover { border-color: var(--primary); color: var(--primary); }



.result-box { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-top: 15px; text-align: center; }

.big-number { font-size: 28px; font-weight: bold; color: var(--primary); }


table.report { width: 100%; border-collapse: collapse; margin-top: 10px; }

table.report th, table.report td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 14px; }

table.report th { background: #f0f0f0; }

.report-meta { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; background: #fff; }

.chk-row { display: flex; align-items: center; margin-bottom: 10px; }

.chk-row input { width: auto; margin-right: 10px; }


#liveKValue { font-size: 13px; color: var(--primary); font-weight: bold; text-align: right; margin-top: -10px; margin-bottom: 15px; height: 20px; }

.advice-text { font-weight: bold; color: #d35400; margin-top: 5px; }

.photo-preview { max-width: 100%; height: auto; margin-top: 10px; border-radius: 8px; display: none; }

.fan-calc-box { border-top: 1px solid #ccc; margin-top: 20px; padding-top: 10px; }

.fan-calc-row { display: flex; gap: 10px; margin-bottom: 5px; }



/* UUDET TYYLIT: TASAPAINOTUS & ALLEKIRJOITUS */

.balance-card { background: #f8f9fa; border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 10px; }

.balance-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px; }

.balance-alert { padding: 10px; border-radius: 6px; color: white; font-weight: bold; text-align: center; margin-top: 10px; }

.bg-ok { background-color: var(--success); }

.bg-warn { background-color: #fd7e14; }

.bg-err { background-color: var(--danger); }


.signature-wrapper { border: 2px dashed #ccc; background: #fff; height: 150px; position: relative; margin-top: 10px; touch-action: none; }

#signaturePad { width: 100%; height: 100%; cursor: crosshair; }

.clear-sig-btn { position: absolute; top: 5px; right: 5px; font-size: 12px; background: #eee; border: 1px solid #ccc; padding: 2px 5px; cursor: pointer; }

#reportLogoImg { max-height: 50px; max-width: 150px; display: none; margin-bottom: 10px; }
/* PROJEKTIN LUONTI-IKKUNA */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 3000; }
        .modal-box { background: white; padding: 20px; border-radius: 12px; width: 85%; max-width: 350px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .modal-box h3 { margin-top: 0; }

        /* VISUAL STYLES */
                /* UUDET VISUAALISET TYYLIT (KERROSTALO) */
                                /* Useampi torni vierekk√§in */
                                .vis-wrapper { display: flex; flex-direction: row; gap: 50px; justify-content: flex-start; padding-bottom: 50px; }
                                /* Yksitt√§inen torni */
                                .vis-tower { 
                                        display: flex; 
                                        flex-direction: column-reverse; /* Alhaalta yl√∂s */
                                        align-items: center; 
                                        gap: 10px; 
                                        border: 1px dashed #ccc; /* Kehys tornille */
                                        padding: 20px;
                                        background: rgba(255,255,255,0.5);
                                        border-radius: 10px;
                                        min-width: 200px;
                                }
                .vis-tower { display: flex; flex-direction: column-reverse; align-items: center; gap: 10px; padding-bottom: 50px; }
                .vis-shaft-container { display:flex; flex-direction: column-reverse; align-items: center; width: 100%; }
                /* Kerros on nyt vaakarivi */
                .vis-floor { 
                        display: flex; 
                        flex-direction: row; /* Asunnot vierekk√§in */
                        justify-content: center; 
                        align-items: center; 
                        gap: 20px; 
                        padding: 10px; 
                        border-bottom: 1px dashed #ccc; /* Lattian raja */
                        width: 100%;
                        max-width: 800px;
                }
                .vis-apt { 
                        background: white; 
                        border: 2px solid #ccc; 
                        border-radius: 6px; 
                        padding: 8px; 
                        width: 100px; 
                        font-size: 11px;
                        text-align: center; 
                        box-shadow: 2px 2px 5px rgba(0,0,0,0.1); 
                        cursor: pointer; 
                        transition: transform 0.1s;
                }
                .vis-apt:active { transform: scale(0.95); }
                .vis-status-ok { border-color: var(--success); background: #e6fffa; }
                .vis-status-err { border-color: var(--danger); background: #fff0f0; }
                /* ASUNTO-MODAL */
                .apt-modal-table input { width: 50px; padding: 4px; text-align: center; border: 1px solid #ddd; }
                .apt-header { background: var(--primary); color: white; padding: 10px; border-radius: 8px 8px 0 0; display:flex; justify-content:space-between; align-items:center; }

/* GENERAATTORIN TYYLIT */
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 9999; }
.gen-box { background: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 350px; max-height: 90vh; overflow-y: auto; }
.gen-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.gen-row input[type="number"], .gen-row input[type="text"] { width: 70px; text-align: center; margin: 0; padding: 5px; }
.gen-group { border: 1px solid #eee; padding: 10px; border-radius: 8px; margin-bottom: 10px; background: #f9f9f9; }

/* GENERAATTORIN IKKUNA */
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 9999; }
.modal-content { background: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
.gen-row { display:flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.gen-row input { width: 60px; text-align: center; margin: 0; }

/* Visual Towers Layout */
.vis-wrap{display:flex;gap:16px;align-items:flex-end;justify-content:flex-start;padding:8px;}
.vis-tower{display:flex;flex-direction:column-reverse;align-items:center;gap:8px;min-width:220px;border:1px solid #ccc;border-radius:8px;padding:8px;background:#fafafa}
.vis-roof{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;background:#fff;border:1px dashed #bbb;border-radius:6px;padding:6px}
.vis-roof .duct{display:flex;align-items:center;gap:6px;padding:4px 6px;background:#eef;border:1px solid #99b;border-radius:4px}
.vis-floor{display:flex;flex-direction:row;align-items:flex-end;gap:8px;width:100%;}
.vis-apt{display:flex;flex-direction:column;gap:6px;min-width:140px;background:#fff;border:1px solid #ddd;border-radius:6px;padding:6px}
.vis-apt .apt-head{display:flex;align-items:center;justify-content:space-between;font-weight:600;color:#333}
.vis-apt .apt-body{display:flex;flex-wrap:wrap;gap:6px}
.valve-chip{display:flex;align-items:center;gap:6px;padding:4px 6px;border:1px solid #ccc;border-radius:12px;background:#f7f7f7;font-size:12px}
.valve-chip .room{font-weight:600;color:#222;max-width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.valve-chip .meta{color:#555;max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.vis-caption{font-size:12px;color:#666;margin-top:-2px}
.vis-colhead{font-size:14px;font-weight:600;color:#222;margin:4px 0 0 2px}

/* Horizontal cards list */
.vis-horizontal{display:flex;flex-direction:column;gap:10px;padding:8px}
.duct-card{border:1px solid #ddd;border-radius:8px;background:#fff;padding:8px}
.duct-card .duct-head{display:flex;justify-content:space-between;font-weight:600;margin-bottom:6px}
.duct-card .valves{display:flex;flex-wrap:wrap;gap:6px}

/* Responsive: stack towers on narrow screens */
@media (max-width: 900px) {
        .vis-wrap{flex-wrap:wrap}
        .vis-tower{min-width:100%;}
}

/* Utility */
.badge{display:inline-block;padding:2px 6px;border-radius:10px;background:#eee;border:1px solid #ccc;font-size:12px}
.badge.extract{background:#ffecec;border-color:#ffb3b3}
.badge.supply{background:#ecffef;border-color:#b3ffbf}

/* --- KERROSTALO-N√ÑKYM√ÑN TYYLIT (FINAL) --- */
/* Rullattava alue (valinnainen k√§√§re jos k√§yt√∂ss√§) */
#visScrollArea{overflow:auto;height:80vh;background:#eef;position:relative;touch-action:pan-x pan-y}
/* P√§√§alue: Tornit vierekk√§in */
#visContent{transform-origin:0 0;transition:transform 0.2s ease;padding:16px;display:flex;flex-direction:row;align-items:flex-start;gap:24px;min-width:max-content}
.vis-zoombar{position:fixed;right:16px;bottom:90px;display:flex;flex-direction:column;gap:8px;z-index:3000}
.vis-zoombtn{width:36px;height:36px;border-radius:8px;border:1px solid #bbb;background:#fff;cursor:pointer;font-weight:700}
/* Yksi torni (esim. A-rappu) */
.vis-tower{display:flex;flex-direction:column;align-items:center;position:relative;border:2px dashed #ccc;background:rgba(255,255,255,0.5);border-radius:12px;padding:14px 8px;min-width:180px}
.vis-tower-head{font-size:14px;font-weight:700;color:#222;margin-bottom:6px}
/* Huippuimuri katolla */
.vis-roof-unit{width:100px;background:#333;color:#fff;text-align:center;padding:8px;border-radius:5px;margin-bottom:0;z-index:2;box-shadow:0 5px 10px rgba(0,0,0,0.3);border:2px solid #000}
.vis-roof-unit .sum{font-size:10px;color:#ddd;margin-top:4px}
/* Pystyhormi (Putki) */
.vis-shaft-line{width:16px;background:linear-gradient(90deg,#999,#ddd,#999);position:absolute;top:50px;bottom:20px;left:50%;margin-left:-8px;z-index:0;border-radius:0 0 8px 8px}
/* Kerrosten s√§ili√∂ (k√§√§nteinen j√§rjestys: 1. krs alas) */
.vis-floors-container{display:flex;flex-direction:column-reverse;width:100%;z-index:1;gap:10px;margin-top:6px}
/* Yksi kerros */
.vis-floor{display:flex;flex-direction:row;justify-content:center;gap:10px;padding:4px;position:relative}
.vis-floor::before{content:"";position:absolute;top:50%;left:10%;right:10%;height:4px;background:#ccc;z-index:-1}
/* Asuntolaatikko */
.vis-apt{background:#fff;border:2px solid #ccc;border-radius:6px;padding:5px;width:80px;font-size:9px;text-align:center;cursor:pointer;box-shadow:2px 2px 5px rgba(0,0,0,0.1);transition:0.2s;position:relative}
.vis-apt[data-status="ok"]{background:#d6f5d6}
.vis-apt[data-status="warn"]{background:#fff3cd}
.vis-apt[data-status="err"]{background:#fde2e1}
.vis-apt[data-status="none"]{background:#f1f1f1}
.vis-apt:hover{transform:scale(1.1);z-index:10;border-color:#0b5ed7}
.vis-apt .apt-tooltip{position:absolute;left:50%;transform:translateX(-50%);bottom:100%;margin-bottom:6px;background:#222;color:#fff;font-size:11px;padding:4px 6px;border-radius:4px;white-space:nowrap;display:none}
.vis-apt:hover .apt-tooltip{display:block}
.vis-floor::after{content:attr(data-floor-label);position:absolute;left:-34px;top:6px;font-size:11px;color:#777}
.vis-status-warn{background:#fff6e5;border-color:#ffd27a}
.vis-status-ok{background:#e6fffa;border-color:#28a745}
.vis-status-err{background:#fff0f0;border-color:#dc3545}
.vis-status-none{background:#f9f9f9;border-color:#ddd}

/* --- UUSI IV-KONE N√ÑKYM√Ñ (SCHEMATIC) --- */
/* P√§√§asettelu: Kone ylh√§√§ll√§, haarat alla */
.ahu-layout { display: flex; flex-direction: row; align-items: center; width: 100%; gap: 24px; }
/* Koneen ulkon√§k√∂ */
.ahu-unit { 
        width: 160px; height: 120px; 
        background: linear-gradient(135deg, #555, #333); 
        border: 4px solid #777; border-radius: 8px;
        color: white; display: flex; flex-direction: column; 
        align-items: center; justify-content: center; 
        box-shadow: 0 10px 20px rgba(0,0,0,0.3); z-index: 10;
        position: relative;
}
/* Manifold: kone vasemmalla, kanavapuut oikealla */
.ahu-manifold { display: flex; flex-direction: column; gap: 24px; flex: 1; }
/* Tulo- ja poisto-alueet oikealla, ilman riste√§mist√§ */
.ahu-area { position: relative; padding-left: 60px; }
.ahu-area-title{font-size:12px;color:#444;margin:0 0 6px 0}
/* P√§√§putket (yl√§- ja ala-runko) koneen kyljest√§ oikealle */
.ahu-header { position: relative; height: 36px; }
.ahu-header .line { position:absolute; left:0; right:0; top:50%; height:8px; border-radius:4px; }
.ahu-header.supply .line { background: linear-gradient(90deg, #2196F3, #64b5f6); }
.ahu-header.extract .line { background: linear-gradient(90deg, #e91e63, #f48fb1); }
/* Pystyrunko, joka jatkuu yl√∂s/alas oikealla puolella */
.ahu-vertical { position: relative; width: 8px; background:#ccc; border-radius:4px; margin-left: 120px; }
.ahu-vertical.up { height: 140px; }
.ahu-vertical.down { height: 140px; }
.ahu-branch-wrap { display:flex; flex-direction:column; gap:12px; margin-top: 10px; margin-left:160px; }
/* Haaralaatikot kiinnittyv√§t vertikaaliseen runkoon */
.ahu-branch { position: relative; z-index: 1; background: rgba(255,255,255,0.95); border: 2px solid #ccc; border-radius: 8px; padding: 10px; width: 95%; max-width: 800px; box-shadow: 2px 2px 5px rgba(0,0,0,0.05); }
.branch-head { display:flex; align-items:center; justify-content:space-between; font-size:12px; padding:4px 6px; border:1px solid #ccc; border-radius:6px; background:#fafafa; margin-bottom:8px; }
.branch-head .sum { color:#333; font-weight:600; }
.branch-head .pa { color:#666; font-size:11px; }
.branch-line { position:relative; height:8px; width:100%; border-radius:4px; margin:6px 0 20px 0; background:#bbb; }
.branch-taps { position:relative; height:50px; }
.ahu-branch h4 { margin: 0 0 8px 0; font-size: 12px; text-transform: uppercase; border-bottom: 1px solid #eee; display:flex; justify-content:space-between; align-items:center; }
/* Yhdysviiva rungosta haaraan */
.branch-connector { position:absolute; left:-40px; top:18px; width:40px; height:6px; border-radius:3px; }
/* Haara yhteenvedon tyyli */
.branch-summary { font-size:12px; color:#555; margin:4px 0 6px 0; }
/* Venttiilipallukat */
.ahu-valves { display: flex; flex-wrap: wrap; gap: 5px; justify-content: flex-start; }
.ahu-valve { width: 40px; height: 40px; border-radius: 50%; background: white; border: 2px solid #ddd; display: flex; align-items: center; justify-content: center; font-size: 9px; font-weight: bold; cursor: pointer; transition: 0.2s; }
.ahu-valve:active { transform: scale(0.9); }
/* Venttiilien runkolinja haaran sis√§ll√§ */
.branch-pipe { position: relative; height:8px; width:100%; background:#bbb; border-radius:4px; margin:8px 0 24px 0; }
.tap { position:absolute; width:2px; background:#666; height:22px; top:8px; }
.tap-label { position:absolute; top:32px; transform:translateX(-50%); background:#fff; border:1px solid #ddd; border-radius:6px; padding:4px 6px; font-size:11px; white-space:nowrap; }
.tap.ok .tap-label{ border-color:#28a745; background:#e6fffa }
.tap.err .tap-label{ border-color:#dc3545; background:#fff0f0 }
.tap.none .tap-label{ color:#999 }

/* J√§rjestyksen siirto -nappi */
.ahu-orderbar { display:flex; justify-content:flex-end; gap:8px; margin:0 0 6px 0; }
.btn-order { font-size:12px; padding:4px 8px; border:1px solid #bbb; border-radius:6px; background:#fff; cursor:pointer }
.btn-order:hover { background:#f4f4f4 }

/* Yhteysviivat koneesta: yl√∂s/oikealle tulo, alas/oikealle poisto */
.ahu-unit::before { content:""; position:absolute; right:-20px; top:30%; width:20px; height:6px; background:#2196F3; border-radius:3px; }
.ahu-unit::after { content:""; position:absolute; right:-20px; bottom:30%; width:20px; height:6px; background:#e91e63; border-radius:3px; }

/* Pienet animaation nuolet putkiin */
.flow-arrow { position:absolute; width:12px; height:6px; background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.9)); border-radius:3px; }
.flow-blue { filter: drop-shadow(0 0 2px #2196F3); }
.flow-red { filter: drop-shadow(0 0 2px #e91e63); }
/* Rightward and leftward flow animations */
.flow-right { animation: flowR 1.2s linear infinite; }
.flow-left { animation: flowL 1.2s linear infinite; }
@keyframes flowR { from { transform: translateX(0); } to { transform: translateX(120px); } }
@keyframes flowL { from { transform: translateX(0); } to { transform: translateX(-120px); } }
/* Yksitt√§inen haara (Runko) */
.ahu-branch { 
        position: relative; z-index: 1; 
        background: rgba(255,255,255,0.9); 
        border: 2px solid #ccc; 
        border-radius: 8px; 
        padding: 10px; 
        margin-bottom: 20px; 
        width: 90%;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
}
.ahu-branch h4 { margin: 0 0 5px 0; font-size: 12px; text-transform: uppercase; border-bottom: 1px solid #eee; }
/* Venttiilipallukat */
.ahu-valves { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; }
.ahu-valve {
        width: 40px; height: 40px; 
        border-radius: 50%; 
        background: white; border: 2px solid #ddd;
        display: flex; align-items: center; justify-content: center;
        font-size: 9px; font-weight: bold;
        cursor: pointer;
        transition: 0.2s;
}
.ahu-valve:active { transform: scale(0.9); }

/* ANIMAATIOT JA INTERAKTIIVISUUS */
.vis-apt {
        transition: transform 0.25s cubic-bezier(.4,2,.3,1), box-shadow 0.2s;
}
.vis-apt:hover {
        transform: translateY(-8px) scale(1.04);
        box-shadow: 0 8px 24px rgba(40,167,69,0.15), 0 2px 8px rgba(0,0,0,0.08);
        z-index: 2;
}
.vis-apt::before{content:"";position:absolute;left:-14px;top:50%;width:12px;height:2px;background:#bbb;border-radius:2px}
.vis-apt-popup {
        position: absolute;
        left: 50%;
        top: 110%;
        transform: translateX(-50%);
        background: #fff;
        border: 2px solid #28a745;
        border-radius: 10px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.18);
        padding: 18px 22px;
        min-width: 220px;
        font-size: 15px;
        animation: fadeInPop 0.3s;
        z-index: 10;
}
@keyframes fadeInPop {
        from { opacity: 0; transform: translateX(-50%) scale(0.95); }
        to { opacity: 1; transform: translateX(-50%) scale(1); }
}
.vis-apt-popup-close {
        position: absolute;
        top: 8px;
        right: 12px;
        font-size: 18px;
        color: #dc3545;
        cursor: pointer;
}
.vis-apt-popup-close:hover {
        color: #a71d2a;
}
.vis-apt-popup-list {
        margin-top: 10px;
        padding-left: 0;
        list-style: none;
}
.vis-apt-popup-list li {
        padding: 6px 0;
        border-bottom: 1px solid #eee;
        font-size: 14px;
}
.vis-apt-popup-list li:last-child {
        border-bottom: none;
}
.vis-apt-popup-vent {
        color: #0066cc;
        font-weight: bold;
        margin-right: 6px;
}
.vis-apt-popup-flow {
        color: #28a745;
        margin-left: 8px;
}
.vis-apt-popup-target {
        color: #fd7e14;
        margin-left: 4px;
}
.vis-apt-popup-room {
        color: #333;
        margin-left: 4px;
}
.vis-apt-popup-advice {
        font-size: 12px;
        margin-left: 8px;
}
.vis-apt-popup-advice-ok { color: #28a745; }
.vis-apt-popup-advice-open { color: #0066cc; }
.vis-apt-popup-advice-restrict { color: #fd7e14; }

.valve-node {
        transition: transform 0.18s cubic-bezier(.4,2,.3,1), box-shadow 0.18s;
}
.valve-node:hover {
        transform: scale(1.09);
        box-shadow: 0 8px 24px rgba(0,102,204,0.12), 0 2px 8px rgba(0,0,0,0.08);
        z-index: 2;
}
/* ROOM VIEW STYLES */
.room-header {
        background: #fff;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
    }
    .room-stat-row {
        display: flex;
        justify-content: space-between;
        margin-top: 5px;
        font-size: 14px;
    }
    .room-cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 15px;
    }
    
    /* VENTTIILIKORTTI */
    .valve-card {
        background: #fff;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        position: relative;
        border: 1px solid #eee;
        border-left-width: 5px; /* V√§rikoodi tulee t√§h√§n */
    }
    
    /* V√§rikoodit */
    .valve-card.index { border-left-color: #2196F3; } /* Sininen - Indeksi */
    .valve-card.error { border-left-color: #dc3545; } /* Punainen - Iso virhe */
    .valve-card.warn  { border-left-color: #ffc107; } /* Keltainen/Oranssi - Varoitus */
    .valve-card.ok    { border-left-color: #28a745; } /* Vihre√§ - OK */
    
    .valve-card h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
        color: #333;
        padding-right: 30px; /* Tilaa nuolille */
    }
    .vc-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
        font-size: 13px;
        color: #555;
    }
    .vc-val {
        font-weight: bold;
        color: #000;
    }
    .vc-highlight {
        background: #e3f2fd;
        padding: 2px 6px;
        border-radius: 4px;
        color: #1565c0;
        font-weight: bold;
    }
    
    /* J√§rjestysnapit kortin sis√§ll√§ */
    .card-move-btns {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    .move-btn {
        background: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 24px;
        height: 24px;
        font-size: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #555;
    }
    .move-btn:hover {
        background: #e0e0e0;
    }
    /* ROOM PANEL START */
.room-panel {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        width: 320px;
        max-width: 90vw;
        background: #ffffff;
        box-shadow: -2px 0 10px rgba(0,0,0,0.15);
        z-index: 2000; /* Visuaalin p√§√§ll√§ */
        display: flex;
        flex-direction: column;
        transition: transform 0.3s ease-in-out;
        border-left: 1px solid #ddd;
    }
    
    .room-panel.hidden {
        transform: translateX(100%);
    }
    
    .room-panel-header {
        padding: 15px;
        background: #f8f9fa;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .room-panel-header h3 {
        margin: 0;
        font-size: 16px;
        color: #333;
    }
    
    .rp-close-btn {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #999;
    }
    
    .rp-summary {
        display: flex;
        padding: 10px 15px;
        background: #fff;
        border-bottom: 1px solid #eee;
        justify-content: space-between;
    }
    
    .rp-stat {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    .rp-label { font-size: 10px; color: #888; text-transform: uppercase; }
    .rp-val { font-weight: bold; font-size: 14px; color: #333; }
    
    .rp-valves-list {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        background: #f4f7f9;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    /* Paneelin sis√§inen kortti */
    .rp-card {
        background: #fff;
        border-radius: 6px;
        padding: 10px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        border: 1px solid #eee;
        border-left: 4px solid #ccc;
        position: relative;
    }
    
    .rp-card.index { border-left-color: #2196F3; } /* Sininen */
    .rp-card.ok { border-left-color: #4CAF50; }
    .rp-card.warn { border-left-color: #FFC107; }
    .rp-card.error { border-left-color: #F44336; }
    
    .rp-card-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
    }
    .rp-room-name { font-weight: bold; font-size: 13px; }
    .rp-model-info { font-size: 10px; color: #777; }
    
    .rp-data-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 5px;
        font-size: 12px;
        margin-bottom: 8px;
    }
    .rp-data-row { display: flex; justify-content: space-between; }
    .rp-data-val { font-weight: bold; }
    
    .rp-action-box {
        background: #e3f2fd;
        padding: 6px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        color: #1565c0;
        text-align: center;
        border: 1px solid #bbdefb;
    }
    .rp-action-box.index {
        background: #e8f5e9;
        color: #2e7d32;
        border-color: #c8e6c9;
    }
    
    .rp-footer {
        padding: 15px;
        border-top: 1px solid #eee;
        background: #fff;
    }
    .rp-advice-box {
        font-size: 11px;
        color: #555;
        background: #fff8e1;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ffe0b2;
    }
    
    /* Highlight kartalla kun paneeli auki */
    .vis-apt.active-room {
        border-color: #2196F3 !important;
        box-shadow: 0 0 10px rgba(33, 150, 243, 0.5) !important;
        z-index: 50 !important;
    }
    .vis-apt.dimmed {
        opacity: 0.4;
    }
    .vc-state {
        margin-top: 6px;
        font-size: 11px;
        font-weight: bold;
        padding: 3px 6px;
        border-radius: 6px;
        width: 100%;
        text-align: center;
    }
    
    .vc-state.ok {
        background: #e8f5e9;
        color: #2e7d32;
    }
    
    .vc-state.adjust {
        background: #fff8e1;
        color: #f57f17;
    }
    
    .vc-state.idx {
        background: #e3f2fd;
        color: #1565c0;
    }
    .v-click-area {
        width: 100%;
        cursor: pointer;
    }
    
    .lock-btn {
        z-index: 20;
        pointer-events: auto;
    }
    
    .idx-icon {
        pointer-events: none;
    }
/* 2.6.9.5 Index limit badge */
.idx-limit-badge{
        position:absolute;
        top:4px;
        right:4px;
        font-size:10px;
        font-weight:800;
        background:#fff3e0;
        color:#e65100;
        border:1px solid #ffe0b2;
        padding:2px 6px;
        border-radius:10px;
        z-index:7;
    }
    .duct-warn{
        margin-left:10px;
        font-size:11px;
        font-weight:700;
        color:#e65100;
        background:#fff3e0;
        border:1px solid #ffe0b2;
        padding:3px 8px;
        border-radius:12px;
    }
/* 2.7.5.3: Lukitse muut kortit, kun ollaan koneen s√§√§d√∂ss√§ */
.phase-adjust-machine .vis-pipes-col {
        opacity: 0.45;
      }
      
      /* Est√§ klikkaukset putki- ja venttiilialueelta */
      .phase-adjust-machine .vis-pipes-col,
      .phase-adjust-machine .vis-pipes-col * {
        pointer-events: none;
      }
      
      /* Mutta konekortti pit√§√§ olla edelleen klikattava */
      .phase-adjust-machine .vis-machine-card,
      .phase-adjust-machine .vis-machine-card * {
        pointer-events: auto;
      }
      .phase-adjust-machine .vis-machine-card {
        opacity: 1 !important;
        cursor: pointer;
        box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.35);
      }
      /* 2.7.5.3 ‚Äì Lukitse putket ja venttiilit koneen s√§√§d√∂n ajaksi */

.phase-adjust-machine .vis-pipes-col {
        opacity: 0.45;
      }
      
      /* Est√§ KAIKKI klikkaukset putkialueella */
      .phase-adjust-machine .vis-pipes-col,
      .phase-adjust-machine .vis-pipes-col * {
        pointer-events: none;
      }
      
      /* Mutta konekortti saa toimia */
      .phase-adjust-machine .vis-machine-card,
      .phase-adjust-machine .vis-machine-card * {
        pointer-events: auto;
      }
      /* 2.7.5 ‚Äì Venttiilikortin klikattavuus (HTML-string renderer) */

/* Perustila: ei hoveria, ei k√§tt√§ */
.valve-card {
        cursor: default;
        transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s;
      }
      
      /* Sallittu s√§√§t√∂: kortti on klikattava */
      .valve-card[data-clickable="true"] {
        cursor: pointer;
      }
      
      /* Hover vain sallituissa korteissa */
      .valve-card[data-clickable="true"]:hover {
        transform: scale(1.02);
        box-shadow: 0 0 0 2px rgba(33,150,243,0.35);
      }
      
      /* Estetty kortti: himmennys */
      .valve-card[data-clickable="false"] {
        opacity: 0.45;
      }
/* 2.7.5 ‚Äì Venttiilin klikattavuus (v-click-area) */

.v-click-area {
        cursor: default;
        transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s;
      }
      
      .v-click-area[data-clickable="false"] {
        opacity: 0.45;
      }
      
      .v-click-area[data-clickable="true"] {
        cursor: pointer;
      }
      
      .v-click-area[data-clickable="true"]:hover {
        transform: scale(1.04);
        box-shadow: 0 0 0 2px rgba(33,150,243,0.35);
      }
            /* 2.7.6 ‚Äì Indeksiventtiilin selke√§ tila */

.vc-advice.idx-warning {
        background: #fff8e1;
        color: #6d4c41;
        border: 1px solid #ffe082;
        font-size: 11px;
        font-weight: 600;
        text-align: center;
        margin-top: 6px;
    }
    
    .vc-advice.idx-warning.limit {
        background: #ffebee;
        color: #b71c1c;
        border-color: #ef9a9a;
    }
    
    /* Indeksi ei saa n√§ytt√§√§ klikattavalta */
    .idx-glow .v-click-area {
        cursor: default !important;
    }
    /* 2.7.7 ‚Äì Kontekstuaaliset mikro-vihjeet */

.vc-hint {
        font-size: 11px;
        margin-top: 6px;
        padding: 4px 6px;
        border-radius: 6px;
        line-height: 1.3;
    }
    
    .vc-hint.primary {
        background: #e3f2fd;
        color: #0d47a1;
        border: 1px solid #90caf9;
        font-weight: 600;
    }
    
    .vc-hint.muted {
        background: #f1f8e9;
        color: #33691e;
        border: 1px solid #c5e1a5;
    }
    
    .vc-hint.wait {
        background: #fbe9e7;
        color: #bf360c;
        border: 1px dashed #ffab91;
    }
    .k-badge {
        position: absolute;
        top: 6px;
        right: 6px;
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 6px;
        font-weight: 600;
        opacity: 0.9;
    }
    
    .k-badge.approved {
        background: #e8f5e9;
        color: #2e7d32;
        border: 1px solid #a5d6a7;
    }
    
    .k-badge.working {
        background: #fff3e0;
        color: #ef6c00;
        border: 1px solid #ffcc80;
    }
    
    .k-badge.none {
        background: #f5f5f5;
        color: #666;
        border: 1px solid #ccc;
    }
    .lock-tooltip {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        cursor: help;
    }
    
    .lock-tooltip .lock-text {
        font-size: 10px;
        color: #b00020;
        white-space: nowrap;
    }
    
    .lock-tooltip .lock-bubble {
        position: absolute;
        bottom: 125%;
        left: 0;
        background: #222;
        color: #fff;
        padding: 6px 8px;
        border-radius: 6px;
        font-size: 11px;
        line-height: 1.3;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transform: translateY(4px);
        transition: opacity 0.15s ease, transform 0.15s ease;
        z-index: 9999;
    }
    
    .lock-tooltip:hover .lock-bubble {
        opacity: 1;
        transform: translateY(0);
    }
    .valve-card.locked {
        opacity: 0.7;
    }
    .pct-ok { background:#e8f5e9; }
    .pct-warn { background:#fff8e1; }
    .pct-bad { background:#fdecea; }
    
    @media print {
        .pct-ok, .pct-warn, .pct-bad {
            background:none !important;
        }
    }
   /* ===============================
   üî¥ PERUUTA / SULJE -NAPIT
   =============================== */

.btn.btn-cancel {
    background-color: #c62828 !important;
    color: #ffffff !important;
    border: none !important;
}

.btn.btn-cancel:hover {
    background-color: #b71c1c !important;
}

.btn.btn-cancel:active {
    background-color: #8e0000 !important;
}


/* ===============================
   üé® YLEISET TOIMINTONAPIT
   =============================== */

.btn-primary {
    background-color: #1565c0;
    color: #ffffff;
}

.btn-success {
    background-color: #2e7d32;
    color: #ffffff;
}

.btn-warning {
    background-color: #ef6c00;
    color: #ffffff;
}

.btn-edit {
    background-color: #1565c0 !important;
    color: #ffffff !important;
    border: none;
}

.btn-edit:hover {
    background-color: #0d47a1 !important;
}

.btn-edit:active {
    background-color: #08306b !important;
}

.btn-disabled,
button:disabled {
    background-color: #cccccc !important;
    color: #777777 !important;
    cursor: not-allowed;
    opacity: 0.6;
}


/* ===============================
   üìö K-KIRJASTON LUOKKANAPIT
   =============================== */

.k-lib-category-btn {
    background-color: #1976d2;
    color: #ffffff;
    border: none;
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
    font-size: 15px;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
}

.k-lib-category-btn:hover {
    background-color: #1565c0;
}


/* ===============================
   üì± MODAALIT ‚Äì MOBIILI EDELL√Ñ
   =============================== */

.modal {
    width: 96vw;
    max-width: 680px;
    max-height: 92vh;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.modal-content {
    flex: 1 1 auto;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 10px;
}

.modal-actions {
    flex-shrink: 0;
    padding: 8px;
    border-top: 1px solid #dddddd;
    background-color: #ffffff;
}


/* ===============================
   üì± K-VENTTIILIMODAALI
   =============================== */

.k-valve-modal {
    width: 96vw;
    max-width: 640px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.k-valve-modal table {
    width: 100%;
    table-layout: fixed;
    font-size: 13px;
}

.k-valve-modal th,
.k-valve-modal td {
    padding: 6px 4px;
    word-break: break-word;
}

.k-valve-modal .btn-xs {
    padding: 6px 8px;
    font-size: 14px;
    min-width: 44px; /* kosketusyst√§v√§llinen */
}

.k-valve-modal button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
}


/* ===============================
   üì± TOIMINTONAPIT MOBIILISSA
   =============================== */

@media (max-width: 520px) {

    /* Toiminnot-sarake allekkain */
    .k-valve-modal td:last-child {
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-items: stretch;
    }

    .k-valve-modal .btn-xs {
        width: 100%;
    }
}


/* ===============================
   üî¥ VARMISTUS: SULJE PUNAINEN KAIKISSA MODAALEISSA
   =============================== */

.modal-actions .btn-cancel,
.modal-actions button[onclick*="close"] {
    background-color: #c62828 !important;
    color: #ffffff !important;
}


      
    /* ROOM PANEL END */